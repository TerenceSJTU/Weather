<?php  require_once('func.php');  require_once('get_guest_info.php');    $query_string = $_SERVER["QUERY_STRING"];  if ($_POST) {      $w_info = get_weather_by_name($_POST['city']);  } elseif (preg_match('/^c=(\d{9})$/', $query_string, $matches)) {      $city_code = $matches[1];      $w_info    = get_weather_by_code($city_code);  } else {      $gifo     = new get_guest_info();      $address  = $gifo->Getaddress_2();     $reg_addr = '/((.+)省|新疆|内蒙古|宁夏|广西|西藏)?(.*)市/';      preg_match($reg_addr, $address['country'], $matches);      $prov   = $matches[2] ? $matches[2] : $matches[1];    $city   = $matches[3];     $w_info = get_weather_by_name($city);  }  		$title        = $w_info['city'] . '天气预报';  $cityid       = $w_info['cityid'];  $poster       = "http://poster.weather.com.cn/p_files/base/" . $cityid . ".jpg";  $date         = $w_info['date_y'];  $release_time = $date . $w_info['fchh'] . '时发布';  $tempreture   = array(      $w_info['temp1'],      $w_info['temp2'],      $w_info['temp3'],      $w_info['temp4'],      $w_info['temp5'],	$w_info['temp6']);  $weather      = array(      $w_info['weather1'],      $w_info['weather2'],      $w_info['weather3'],      $w_info['weather4'],      $w_info['weather5'],	$w_info['weather6']	);  $wind         = array(      $w_info['wind1'],      $w_info['wind2'],      $w_info['wind3'],      $w_info['wind4'],      $w_info['wind5'], 	$w_info['wind6'] );  $day_image    = array(      $w_info['img1'],      $w_info['img3'],      $w_info['img5'],      $w_info['img7'],      $w_info['img9'],	$w_info['img11']	);  $night_image  = array(      $w_info['img2'],      $w_info['img4'],      $w_info['img6'],      $w_info['img8'],  	    $w_info['img10'],	$w_info['img12']);  for ($i = 0; $i < 6; $i++) {      $day_image[$i]   = sprintf('%02s', $day_image[$i]);      $night_image[$i] = sprintf('%02s', $night_image[$i]);      if ($night_image[$i] == '99') {          $night_image[$i] = $day_image[$i];      }  }    $reg_date = '/(\d+)年(\d+)月(\d+)日/';  preg_match($reg_date, $date, $matches);  $today = mktime(0, 0, 0, $matches[2], $matches[3], $matches[1]);  $days  = array(      $today,      strtotime('+1 day', $today),      strtotime('+2 day', $today),      strtotime('+3 day', $today),      strtotime('+4 day', $today),	strtotime('+5 day', $today),	);    $index_cy = $w_info['index_d'];   $index_uv = $w_info['index_uv'];   $index_cl = $w_info['index_cl']; $index_ag = $w_info['index_ag']; $index_xc = $w_info['index_xc']; $index_tr = $w_info['index_tr']; $index_co = $w_info['index_co']; $index_ls = $w_info['index_ls']; $data = array(19,23,34,38,45,67,71,78,85,90,96,145);?>   <html>  <head>  	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />  	<script type="text/javascript" src="lib/jquery.js"></script>	<script type="text/javascript" src="lib/jquery.jqplot.1.0.3r1117/dist/jquery.jqplot.min.js"></script> 	<script type="text/javascript" src="lib/jquery.jqplot.1.0.3r1117/dist/plugins/jqplot.logAxisRenderer.min.js"></script>	<script type="text/javascript" src="lib/jquery.jqplot.1.0.3r1117/dist/plugins/jqplot.canvasTextRenderer.min.js"></script>	<script type="text/javascript" src="lib/jquery.jqplot.1.0.3r1117/dist/plugins/jqplot.canvasAxisLabelRenderer.min.js"></script>	<script type="text/javascript" src="lib/jquery.jqplot.1.0.3r1117/dist/plugins/jqplot.canvasAxisTickRenderer.min.js"></script>	<script type="text/javascript" src="lib/jquery.jqplot.1.0.3r1117/dist/plugins/jqplot.dateAxisRenderer.min.js"></script>	<script type="text/javascript" src="lib/jquery.jqplot.1.0.3r1117/dist/plugins/jqplot.pointLabels.min.js"></script>	<script type="text/javascript" src="lib/jquery.jqplot.1.0.3r1117/dist/plugins/jqplot.categoryAxisRenderer.min.js"></script>	<script type="text/javascript" src="lib/jquery.jqplot.1.0.3r1117/dist/plugins/jqplot.barRenderer.min.js"></script>	<script type="text/javascript" src="lib/jquery.jqplot.1.0.3r1117/dist/plugins/jqplot.highlighter.min.js"></script>	<script type="text/javascript" src="lib/jquery.jqplot.1.0.3r1117/dist/plugins/jqplot.cursor.min.js"></script>	<link rel="stylesheet" type="text/css" href="lib/jquery.jqplot.1.0.3r1117/dist/jquery.jqplot.min.css"/>	<title>	<?php   	echo '我的天气预报 - ' . $title;  	?></title>  	<style type="text/css">		body	{		text-align: center;		margin: 20px;		vertical-align: middle;		<?php   		if(preg_match('/转+.*/', $weather[0], $matches))  			$pic_diplay=$matches[0];		else 			$pic_diplay=$weather[0];		if(preg_match('/晴/', $pic_diplay, $matches))			$pic_diplay='1.jpg';		elseif(preg_match('/阴/', $pic_diplay, $matches))				$pic_diplay='2.jpg';		elseif(preg_match('/雨/', $pic_diplay, $matches))				$pic_diplay='3.jpg';		elseif(preg_match('/雪/', $pic_diplay, $matches))				$pic_diplay='2.jpg';			elseif(preg_match('/云/', $pic_diplay, $matches))				$pic_diplay='4.jpg';			else			$pic_diplay='0.jpg';		echo "background:url(pic/".$pic_diplay.");";		?>			background-size:100% 100%;	}	</style>	<link rel="stylesheet" type="text/css" href="css/index.css"/>	</head>  <body><?php echo '<h1>' . $title . '</h1>'; ?>  <form method="post" action="index.php">        <input type="text" name="city" style="border: 1px solid #ccc;" size="13" />        <input type="hidden" name="action" value="change_city" />        <input type="submit" value="更换城市" class="button" />  </form>  <hr />  <table align="center" width="700px",border="0">  <tr>   <th width="10%"> </th>    <th width="20%"> </th>    <th width="70%"> </th>  </tr>  <tr>  <td></td>    <td ><div class="calender"><SCRIPT> function Year_Month(){ 	var now = new Date(); 	var yy = now.getFullYear(); 	var mm = now.getMonth()+1; 	var cl = '<font color="#0000df">'; 	if (now.getDay() == 0) cl = '<font color="#c00000">'; 	if (now.getDay() == 6) cl = '<font color="#00c000">'; 	return(cl + yy + '年' + mm + '月</font>'); } function Date_of_Today(){ 	var now = new Date(); 	var cl = '<font color="#ff0000">'; 	if (now.getDay() == 0) cl = '<font color="#c00000">'; 	if (now.getDay() == 6) cl = '<font color="#00c000">'; 	return(cl + now.getDate() + '</font>'); } function Day_of_Today(){ 	var day = new Array(); 	day[0] = "星期日"; 	day[1] = "星期一"; 	day[2] = "星期二"; 	day[3] = "星期三"; 	day[4] = "星期四"; 	day[5] = "星期五"; 	day[6] = "星期六"; 	var now = new Date(); 	var cl = '<font color="#0000df">'; 	if (now.getDay() == 0) cl = '<font color="#c00000">'; 	if (now.getDay() == 6) cl = '<font color="#00c000">'; 	return(cl + day[now.getDay()] + '</font>'); } 	function CurentTime(){ 	var now = new Date(); 	var hh = now.getHours(); 	var mm = now.getMinutes(); 	var ss = now.getTime() % 60000; 	ss = (ss - (ss % 1000)) / 1000; 	var clock = hh+':'; 	if (mm < 10) clock += '0'; 	clock += mm+':'; 	if (ss < 10) clock += '0'; 	clock += ss; 	return(clock); } function refreshCalendarClock(){ 	document.all.calendarClock1.innerHTML = Year_Month(); 	document.all.calendarClock2.innerHTML = Date_of_Today(); 	document.all.calendarClock3.innerHTML = Day_of_Today(); 	document.all.calendarClock4.innerHTML = CurentTime(); } 	var webUrl = webUrl; 	document.write('<table border="0" cellpadding="0" cellspacing="0"><tr><td>'); 	document.write('<table id="CalendarClockFreeCode" border="0" cellpadding="0" cellspacing="0" width="60" height="70" '); 	document.write('style="position:absolute;visibility:hidden" bgcolor="#eeeeee">'); 	document.write('<tr><td align="center"><font '); 	document.write('style="cursor:hand;color:#ff0000;font-family:宋体;font-size:14pt;line-height:120%" '); 	if (webUrl != 'netflower'){ 		document.write('</td></tr><tr><td align="center"><font '); 	document.write('style="cursor:hand;color:#2000ff;font-family:宋体;font-size:9pt;line-height:110%" '); 	} 	document.write('</td></tr></table>'); 	document.write('<table border="0" cellpadding="0" cellspacing="0" width="89" bgcolor="#C0C0C0" height="90">'); 	document.write('<tr><td valign="top" width="100%" height="100%">'); 	document.write('<table border="1" cellpadding="0" cellspacing="0" width="88" bgcolor="#FEFEEF" height="87">'); 	document.write('<tr><td align="center" width="100%" height="100%" >'); 	document.write('<font id="calendarClock1" style="font-family:宋体;font-size:7pt;line-height:120%"> </font><br>'); 	document.write('<font id="calendarClock2" style="color:#ff0000;font-family:Arial;font-size:14pt;line-height:120%"> </font><br>'); 	document.write('<font id="calendarClock3" style="font-family:宋体;font-size:9pt;line-height:120%"> </font><br>'); 	document.write('<font id="calendarClock4" style="color:#100080;font-family:宋体;font-size:8pt;line-height:120%"><b> </b></font>'); 	document.write('</td></tr></table>'); 	document.write('</td></tr></table>'); 	document.write('</td></tr></table>'); 	setInterval('refreshCalendarClock()',1000); </SCRIPT></div></td>    <td align="left"> <?php  printf('今天天气<b>%s</b>，气温<b>%s</b>，<b>%s</b><br />', $weather[0], $tempreture[0], $wind[0]);  echo '<table border="0"><tr><th width="%50"></th><th width=%50></th>  </tr>';echo '<tr><td>';echo '<b>紫外线指数：</b>' . $index_uv .'</td><td>';  echo '<b>&nbsp;&nbsp;&nbsp;&nbsp;舒适度指数：</b>' . $index_co. '</td></tr><tr><td>'; echo '<b>晨练指数：</b>' . $index_cl .'</td><td>' ;  echo '<b>&nbsp;&nbsp;&nbsp;&nbsp;晾晒指数：</b>' . $index_ls  . '</td></tr><tr><td>'; echo '<b>过敏指数：</b>' . $index_ag.'</td><td>' ;  echo '<b>&nbsp;&nbsp;&nbsp;&nbsp;旅游指数：</b>' . $index_tr. '</td></tr></table>'; ?>       </td>  </tr></table><table align="center" width="600px" border="0">  <tr>    <th width="100%" align="left"><?php echo '<b>穿衣指数：</b>' . $index_cy . '<br />';  ?>   </th>      </tr></table><h2>近期温度预测</h2><table align="center" ><tr><th></th><tr><tr><td><div id="temp"  class="class_chart"></div><script type="text/javascript">var JSONObject= <?php echo json_encode($w_info); ?>;var i;var temp = new Array();var temp_day = new Array();var temp_night =new Array();var date = <?php echo json_encode($days); ?>;var day = new Array();for(i=0;i<7;i++){	day[i] = new Date(date[i]* 1000); 	date[i] = day[i].toDateString().substring(0,3);	//alert(date[i]);	}temp[0]=JSONObject.temp1;temp[1]=JSONObject.temp2;temp[2]=JSONObject.temp3;temp[3]=JSONObject.temp4;temp[4]=JSONObject.temp5;temp[5]=JSONObject.temp6;	for(i=0;i<6;i++) {	temp_day[i]=temp[i].substring(4,6);	temp_night[i]=temp[i].substring(0,2);	temp_day[i]=Number(temp_day[i]);	temp_night[i]=Number(temp_night[i]);	}	var data_day = new Array();var data_night =new Array();if(temp_day[0]>temp_night[0]){for(i=0;i<6;i++){	var data = new Array();	data[0]=date[i];	data[1]=temp_day[i];	data_day.push(data);	}for(i=0;i<6;i++){	var data = new Array();	data[0]=date[i];	data[1]=temp_night[i];	data_night.push(data);	}}else{for(i=0;i<6;i++){	var data = new Array();	data[0]=date[i];	data[1]=temp_day[i];	data_night.push(data);	}for(i=0;i<6;i++){	var data = new Array();	data[0]=date[i];	data[1]=temp_night[i];	data_day.push(data);	}}var line1=data_day;var line2=data_night;var plot = $.jqplot ('temp', [line1,line2], {	seriesColors: ['rgba(250, 0, 0,0.7)', 'rgba(56, 70, 243,0.8)'],    legend: { show: true, },    series:[ { label:'day' }, { label:'night' }],	grid:{                background:'rgba(0, 0, 0, 0)',                drawBorder: true,                borderColor: 'rgba(0, 0, 0, 0.8)',                           gridLineColor: 'rgba(0, 0, 0, 0.8)',                shadow: false,            },    seriesDefaults:{                shadow: false,                pointLabels: { 					show: true, 					location: 'n',							},							fontSize: '28px',				lineWidth: 2.5,        },  			axes: {        xaxis: {			renderer: $.jqplot.CategoryAxisRenderer,			tickOptions: {						fontSize:'15px',    						textColor: 'rgba(0, 0, 0, 0.8)',			},			},        yaxis: {				autoscale: true,				label: '℃', 				labelOptions:{fontSize:'15px',   						textColor: 'rgba(0, 0, 0, 0.8)',				},				tickOptions: {				fontSize:'15px',    				textColor: 'rgba(0, 0, 0, 0.8)',			},		}		  		}    });</script></tr></td></table>    <h3>未来5日天气情况</h3> <div class="future_temp">	    <table align="center" class="weather" width="800px">        <tr >      <?php          $dd = array(              '今天',              '明天',              '后天'          );          for ($i = 1; $i < 3; $i++) {              echo '<th style="width:20%">';              printf('%s(%s)', get_week($days[$i]), $dd[$i]);              echo '</th>';          }          for (; $i < 6; $i++) {              echo '<th style="width:20%">';              printf('%s(%s)', get_week($days[$i]), date('j日', $days[$i]));              echo '</th>';          }          ?>      </tr>      <tr>      <?php          for ($i = 1; $i < 6; $i++) {                       echo '<td align="center">';                         printf('<img src="http://wap.weather.com.cn/m/i/icon_weather/21x15/d%s.gif" /><img src="http://wap.weather.com.cn/m/i/icon_weather/21x15/n%s.gif" /><br />', $day_image[$i], $night_image[$i]);              printf('<b>%s</b><br />%s<br />%s', $tempreture[$i], $weather[$i], $wind[$i]);              echo '</td>';          }          ?>      </tr>      </table>  </div></body>  </html>  